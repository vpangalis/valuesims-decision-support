<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Incident & Problem Management</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <div class="board">

        <!-- D0 INCIDENT OVERVIEW -->
        <div class="column col-d0">
            <div class="header">Incident Overview & Evidence</div>
            <div class="content">

                <label>Incident / Case ID</label>
            <input id="case-id-input" placeholder="INC-YYYYMMDD-XXXX" data-json-path="case.case_number">
                <small class="muted">
                    Format: INC-YYYYMMDD-XXXX (e.g. INC-20260116-0001)
                </small>
                <button id="create-incident-btn" disabled>Create Incident</button>
                <small class="muted">
                    This locks the Case ID and enables evidence upload and AI analysis.
                </small>

                <label>Status</label>
                <input value="Open" data-json-path="case.status">

                <label>Opening Date</label>
                <input type="date" data-json-path="case.opening_date">

                <label>Closure Date</label>
                <input type="date" data-json-path="case.closure_date">

                
                <input id="evidence-file-input" type="file" multiple hidden data-json-path="evidence" />

                <button id="upload-evidence-btn" data-action="upload-evidence" disabled>
                    Upload Evidence
                </button>

                <div id="upload-status" class="muted"></div>


                <div id="evidence-list" class="muted">No evidence uploaded yet.</div>
            </div>
            <div class="footer">Status updates automatically when any D1–D8 field is edited.
            </div>
        </div>

        <!-- D1–D2 PROBLEM INITIATION -->
        <div class="column col-d12" data-phase="D1_D2">
            <div class="header"><span>Problem Initiation (D1–D2)</span><span class="phase-status" data-phase-status>not started</span></div>
            <div class="content scroll-y">
                <label>Problem Description</label>
                <textarea data-json-path="phases.D1_D2.data.problem_description"></textarea>

                <div class="two-col">
                    <div>
                        <label>Country</label>
                        <input data-json-path="phases.D1_D2.data.organization.country">
                    </div>
                    <div>
                        <label>Site / Location</label>
                        <input data-json-path="phases.D1_D2.data.organization.site">
                    </div>
                </div>

                <label>Department / Area</label>
                <input data-json-path="phases.D1_D2.data.organization.department">

                <label>Involved People / Teams</label>
                <textarea data-json-path="phases.D1_D2.data.team_members" data-json-array="true"></textarea>
            </div>
            <div class="phase-actions">
                <button class="confirm-phase-btn" data-phase="D1_D2">Confirm D1–D2</button>
            </div>
            <div class="footer">Define scope and context.</div>
        </div>

        <!-- D3 PROBLEM DEFINITION -->
        <div class="column col-d3" data-phase="D3">
            <div class="header"><span>Problem Definition (D3)</span><span class="phase-status" data-phase-status>not started</span></div>
            <div class="content scroll-y">
                <label>What happened?</label>
                <textarea data-json-path="phases.D3.data.what_happened"></textarea>

                <label>Why is this a problem?</label>
                <textarea data-json-path="phases.D3.data.why_problem"></textarea>

                <div class="two-col">
                    <div>
                        <label>When?</label>
                        <input data-json-path="phases.D3.data.when">
                    </div>
                    <div>
                        <label>Where?</label>
                        <input data-json-path="phases.D3.data.where">
                    </div>
                </div>

                <div class="two-col">
                    <div>
                        <label>Who?</label>
                        <input data-json-path="phases.D3.data.who">
                    </div>
                    <div>
                        <label>How identified?</label>
                        <input data-json-path="phases.D3.data.how_identified">
                    </div>
                </div>

                <label>Impact (how many / how much)</label>
                <input data-json-path="phases.D3.data.impact">
            </div>
            <div class="phase-actions">
                <button class="confirm-phase-btn" data-phase="D3">Confirm D3</button>
            </div>
            <div class="footer">Shared factual understanding.</div>
        </div>

        <!-- D4 IMMEDIATE ACTIONS -->
        <div class="column col-d4 wide" data-phase="D4">
            <div class="header"><span>Immediate Actions (D4)</span><span class="phase-status" data-phase-status>not started</span></div>
            <div class="content scroll-y">
                <table>
                    <thead>
                        <tr>
                            <th class="w-action">Action</th>
                            <th class="w-owner">Responsible</th>
                            <th class="w-date">Due</th>
                            <th class="w-date">Actual</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- schema v1: actions[0] -->
                        <tr>
                            <td><input data-json-path="phases.D4.data.actions[0].action"></td>
                            <td><input data-json-path="phases.D4.data.actions[0].responsible"></td>
                            <td><input type="date" data-json-path="phases.D4.data.actions[0].due_date"></td>
                            <td><input type="date" data-json-path="phases.D4.data.actions[0].actual_date"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="phase-actions">
                <button class="confirm-phase-btn" data-phase="D4">Confirm D4</button>
            </div>
            <div class="footer">Contain and protect stakeholders.</div>
        </div>

        <!-- D5 CAUSE ANALYSIS -->
        <div class="column col-d5 huge" data-phase="D5">
            <div class="header"><span>Cause Analysis (D5)</span><span class="phase-status" data-phase-status>not started</span></div>
            <div class="content scroll-y">

                <h3>Fishbone Analysis</h3>
                <div class="fishbone">
                    <!-- 6 categories -->
                    <div class="fish">People / Organization
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.people[0]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.people[1]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.people[2]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.people[3]">
                        </div>
                    </div>
                    <div class="fish">Process / Workflow
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.process[0]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.process[1]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.process[2]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.process[3]">
                        </div>
                    </div>
                    <div class="fish">Tools / Systems
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.tools[0]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.tools[1]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.tools[2]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.tools[3]">
                        </div>
                    </div>
                    <div class="fish">Environment / Context
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.environment[0]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.environment[1]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.environment[2]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.environment[3]">
                        </div>
                    </div>
                    <div class="fish">Policy / Management
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.management[0]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.management[1]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.management[2]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.management[3]">
                        </div>
                    </div>
                    <div class="fish">Mother Nature / Place
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.place[0]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.place[1]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.place[2]">
                        </div>
                        <div class="fish-row">
                            <input placeholder=" " data-json-path="phases.D5.data.fishbone.place[3]">
                        </div>
                    </div>
                </div>

                <div class="two-col">
                    <div>
                        <h3>5 WHYs – Analysis A</h3>
                        <input data-json-path="phases.D5.data.five_whys.A[0]"><input data-json-path="phases.D5.data.five_whys.A[1]"><input data-json-path="phases.D5.data.five_whys.A[2]"><input data-json-path="phases.D5.data.five_whys.A[3]"><input data-json-path="phases.D5.data.five_whys.A[4]">
                    </div>
                    <div>
                        <h3>5 WHYs – Analysis B</h3>
                        <input data-json-path="phases.D5.data.five_whys.B[0]"><input data-json-path="phases.D5.data.five_whys.B[1]"><input data-json-path="phases.D5.data.five_whys.B[2]"><input data-json-path="phases.D5.data.five_whys.B[3]"><input data-json-path="phases.D5.data.five_whys.B[4]">
                    </div>
                </div>

                <h3>Assignment Tasks for Investigation</h3>
                <table>
                    <thead>
                        <tr>
                            <th class="w-action">Task</th>
                            <th class="w-owner">Responsible</th>
                            <th class="w-date">Due</th>
                            <th class="w-date">Actual</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input data-json-path="phases.D5.data.investigation_tasks[0].task"></td>
                            <td><input data-json-path="phases.D5.data.investigation_tasks[0].responsible"></td>
                            <td><input type="date" data-json-path="phases.D5.data.investigation_tasks[0].due_date"></td>
                            <td><input type="date" data-json-path="phases.D5.data.investigation_tasks[0].actual_date"></td>
                        </tr>
                    </tbody>
                </table>

                <h3>Factor / Tree Analysis</h3>
                <table>
                    <thead>
                        <tr>
                            <th class="w-action">Factor</th>
                            <th class="w-owner">Owner</th>
                            <th class="w-date">Reviewed</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input data-json-path="phases.D5.data.factors[0].factor"></td>
                            <td><input data-json-path="phases.D5.data.factors[0].owner"></td>
                            <td><input data-json-path="phases.D5.data.factors[0].reviewed_date"></td>
                            <td><input data-json-path="phases.D5.data.factors[0].status"></td>
                        </tr>
                    </tbody>
                </table>

            </div>
            <div class="phase-actions">
                <button class="confirm-phase-btn" data-phase="D5">Confirm D5</button>
            </div>
            <div class="footer">Identify and validate root causes.</div>
        </div>

        <!-- D6 PERMANENT ACTIONS -->
        <div class="column col-d6 wide" data-phase="D6">
            <div class="header"><span>Permanent Actions (D6)</span><span class="phase-status" data-phase-status>not started</span></div>
            <div class="content scroll-y">
                <!-- same structure as D4 -->
                <table>
                    <thead>
                        <tr>
                            <th class="w-action">Action</th>
                            <th class="w-owner">Responsible</th>
                            <th class="w-date">Due</th>
                            <th class="w-date">Actual</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- schema v1: actions[0] -->
                        <tr>
                            <td><input data-json-path="phases.D6.data.actions[0].action"></td>
                            <td><input data-json-path="phases.D6.data.actions[0].responsible"></td>
                            <td><input type="date" data-json-path="phases.D6.data.actions[0].due_date"></td>
                            <td><input type="date" data-json-path="phases.D6.data.actions[0].actual_date"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="phase-actions">
                <button class="confirm-phase-btn" data-phase="D6">Confirm D6</button>
            </div>
            <div class="footer">Prevent recurrence.</div>
        </div>

        <!-- D7–D8 PREVENTION & CLOSURE -->
        <div class="column col-d7" data-phase="D7">
            <div class="header"><span>Prevention / Standardization (D7)</span><span class="phase-status" data-phase-status>not started</span></div>
            <div class="content">
                <label>Procedures updated?</label><input type="checkbox" data-json-path="phases.D7.data.procedures_updated">
                <label>Training completed?</label><input type="checkbox" data-json-path="phases.D7.data.training_completed">
            </div>
            <div class="phase-actions">
                <button class="confirm-phase-btn" data-phase="D7">Confirm D7</button>
            </div>
            <div class="footer">Standardisation and prevention.</div>
        </div>

        <div class="column col-d8" data-phase="D8">
            <div class="header"><span>Closure (D8)</span><span class="phase-status" data-phase-status>not started</span></div>
            <div class="content">
                <label>Quality approved?</label><input type="checkbox" data-json-path="phases.D8.data.quality_approved">
                <label>Closure Date</label><input type="date" data-json-path="phases.D8.data.closure_date">
            </div>
            <div class="phase-actions">
                <button class="confirm-phase-btn" data-phase="D8">Confirm D8</button>
            </div>
            <div class="footer">Formal closure.</div>
        </div>

        <!-- AI -->
        <div class="column col-ai">
            <div class="header">AI Analysis</div>
            <div class="content">
                <button data-action="run-agent" disabled>Run AI Analysis</button>
                <div class="muted">Agent status: idle</div>
            </div>
        </div>

    </div>

    <script src="ui.js"></script>

</body>

</html>